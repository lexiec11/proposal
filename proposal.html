<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Party Planner ‚Äî Interactive</title>
  <style>
    :root{
      --bg:#ffffff;
      --leading:#111;
      --muted:#666;
      --card:#fff;
      --line:#e6e6e6;
      --soft:#f7f7f7;
      --radius:16px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; padding:22px;
      font-family: Arial, sans-serif;
      color:var(--leading);
      background:var(--bg);
      line-height:1.45;
    }
    .wrap{max-width:1050px; margin:0 auto;}
    header{
      display:flex; align-items:flex-start; justify-content:space-between;
      gap:16px; margin-bottom:14px;
    }
    h1{margin:0; font-size:28px;}
    .sub{margin:6px 0 0; color:var(--muted)}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      border:1px solid var(--line);
      background:var(--soft);
      padding:10px 12px;
      border-radius:999px;
      font-size:13px;
      color:#222;
      user-select:none;
    }
    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap:14px;
    }
    @media (min-width: 920px){
      .grid{grid-template-columns: 1.2fr 0.8fr;}
    }
    .card{
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:14px;
      background:var(--card);
    }
    .card h2{margin:0 0 10px; font-size:18px;}
    .muted{color:var(--muted)}
    .progress{
      height:10px; width:100%;
      background:var(--soft);
      border:1px solid var(--line);
      border-radius:999px;
      overflow:hidden;
      margin-top:10px;
    }
    .bar{height:100%; width:0%; background:#111;}
    .stepTitle{font-size:16px; margin:0 0 6px;}
    .controls{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;}
    button{
      border:1px solid var(--line);
      background:#111;
      color:#fff;
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      font-weight:700;
      font-size:14px;
    }
    button.secondary{
      background:#fff;
      color:#111;
    }
    button.ghost{
      background:var(--soft);
      color:#111;
    }
    button:disabled{
      opacity:0.45;
      cursor:not-allowed;
    }
    .options{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      margin-top:10px;
    }
    @media (min-width: 560px){
      .options{grid-template-columns: 1fr 1fr;}
    }
    .opt{
      border:1px solid var(--line);
      background:#fff;
      border-radius:14px;
      padding:12px;
      cursor:pointer;
      display:flex;
      gap:10px;
      align-items:flex-start;
      transition: transform 120ms ease, border-color 120ms ease, background 120ms ease;
      user-select:none;
    }
    .opt:hover{transform: translateY(-1px); border-color:#cfcfcf;}
    .opt.selected{border-color:#111; background:var(--soft);}
    .emoji{font-size:22px; line-height:1;}
    .opt b{display:block; margin-bottom:2px;}
    .row{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      margin-top:10px;
    }
    @media (min-width: 560px){
      .row{grid-template-columns: 1fr 1fr;}
    }
    label{display:block; font-weight:700; margin-bottom:6px;}
    input[type="range"]{width:100%;}
    select, input[type="text"]{
      width:100%;
      padding:10px 10px;
      border-radius:12px;
      border:1px solid var(--line);
      background:#fff;
      font-size:14px;
    }
    .valueTag{
      display:inline-block;
      margin-top:6px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:var(--soft);
      font-size:13px;
      color:#222;
    }
    .previewTop{
      display:flex; gap:10px; flex-wrap:wrap;
      margin-top:8px;
    }
    .big{
      font-size:20px;
      margin:4px 0 0;
      font-weight:800;
    }
    .swatches{
      display:flex; gap:8px; flex-wrap:wrap; margin-top:10px;
    }
    .sw{
      width:26px; height:26px; border-radius:999px;
      border:1px solid var(--line);
    }
    .miniList{margin:10px 0 0; padding-left:18px;}
    .tabs{
      display:flex; gap:8px; flex-wrap:wrap;
      margin-top:10px;
    }
    .tab{
      border:1px solid var(--line);
      background:#fff;
      padding:8px 10px;
      border-radius:999px;
      cursor:pointer;
      font-weight:700;
      font-size:13px;
    }
    .tab.active{background:#111; color:#fff; border-color:#111;}
    .panel{display:none; margin-top:12px;}
    .panel.active{display:block;}
    .copyRow{display:flex; gap:10px; flex-wrap:wrap; align-items:flex-start;}
    textarea{
      width:100%;
      min-height:120px;
      border-radius:12px;
      border:1px solid var(--line);
      padding:10px;
      font-size:14px;
      resize:vertical;
    }
    .hint{font-size:13px; color:var(--muted); margin-top:6px;}
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      border:1px dashed var(--line);
      border-radius:12px;
      padding:10px 12px;
      background:#fff;
      margin-top:10px;
    }
    .hr{height:1px; background:var(--line); margin:14px 0;}
    .toast{
      position:fixed;
      left:50%;
      transform:translateX(-50%);
      bottom:18px;
      background:#111;
      color:#fff;
      padding:10px 12px;
      border-radius:12px;
      font-size:14px;
      opacity:0;
      pointer-events:none;
      transition: opacity 150ms ease;
    }
    .toast.show{opacity:1;}
    .smallBtn{
      padding:8px 10px;
      border-radius:10px;
      font-size:13px;
    }
    .twoCol{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    @media (min-width: 720px){
      .twoCol{grid-template-columns: 1fr 1fr;}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Party Planner</h1>
        <p class="sub">Answer a few quick questions ‚Üí get your event type, theme, palette, timeline, shopping list, and invite texts.</p>
        <div class="pill" id="statusPill">Step <span id="stepNum">1</span> of <span id="stepTotal">6</span></div>
      </div>
      <div style="text-align:right;">
        <div class="pill">‚ú® College-friendly ¬∑ clean + modern</div>
        <div class="progress" aria-label="Progress">
          <div class="bar" id="bar"></div>
        </div>
      </div>
    </header>

    <div class="grid">
      <!-- LEFT: QUIZ -->
      <section class="card" id="quizCard">
        <h2>Quick Quiz</h2>

        <!-- Step 1: Vibe cards -->
        <div class="step" data-step="0">
          <p class="stepTitle">1) Pick your vibe</p>
          <p class="muted">This is the biggest driver of your event + theme.</p>
          <div class="options" id="vibeOptions"></div>
        </div>

        <!-- Step 2: Budget + Guests -->
        <div class="step" data-step="1" style="display:none;">
          <p class="stepTitle">2) Budget + guest count</p>
          <div class="row">
            <div>
              <label for="budget">Budget</label>
              <input id="budget" type="range" min="1" max="3" step="1" value="2" />
              <div class="valueTag" id="budgetLabel"></div>
              <div class="hint">1 = low, 2 = medium, 3 = higher</div>
            </div>
            <div>
              <label for="guests">Guest count</label>
              <input id="guests" type="range" min="2" max="60" step="1" value="12" />
              <div class="valueTag" id="guestsLabel"></div>
              <div class="hint">Small + intimate vs bigger + energetic</div>
            </div>
          </div>
        </div>

        <!-- Step 3: Venue + Time -->
        <div class="step" data-step="2" style="display:none;">
          <p class="stepTitle">3) Where + when</p>
          <div class="row">
            <div>
              <label for="venue">Venue</label>
              <select id="venue">
                <option value="apartment">Apartment</option>
                <option value="house">House</option>
                <option value="outdoors">Outdoors</option>
                <option value="restaurant">Restaurant/Bar</option>
                <option value="unknown">Not sure yet</option>
              </select>
            </div>
            <div>
              <label for="timeOfDay">Time</label>
              <select id="timeOfDay">
                <option value="day">Day</option>
                <option value="golden">Golden hour</option>
                <option value="night">Night</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Step 4: Effort + Food -->
        <div class="step" data-step="3" style="display:none;">
          <p class="stepTitle">4) Effort level + food plan</p>
          <div class="row">
            <div>
              <label for="effort">Effort</label>
              <input id="effort" type="range" min="1" max="3" step="1" value="2" />
              <div class="valueTag" id="effortLabel"></div>
              <div class="hint">1 = low lift, 3 = DIY queen</div>
            </div>
            <div>
              <label for="foodStyle">Food</label>
              <select id="foodStyle">
                <option value="snacks">Snacks + drinks</option>
                <option value="potluck">Potluck</option>
                <option value="full">Full meal</option>
                <option value="catered">Catered / ordered</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Step 5: Music + Deadline -->
        <div class="step" data-step="4" style="display:none;">
          <p class="stepTitle">5) Music + how soon is it?</p>
          <div class="row">
            <div>
              <label for="music">Music vibe</label>
              <select id="music">
                <option value="chill">Chill</option>
                <option value="pop">Pop</option>
                <option value="throwbacks">Throwbacks</option>
                <option value="club">Club</option>
                <option value="niche">Niche / themed</option>
              </select>
            </div>
            <div>
              <label for="deadline">Timeline</label>
              <select id="deadline">
                <option value="today">Today (panic plan)</option>
                <option value="48h">48 hours</option>
                <option value="week">This week</option>
                <option value="2w">2+ weeks</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Step 6: Title (optional) -->
        <div class="step" data-step="5" style="display:none;">
          <p class="stepTitle">6) Name your party (optional)</p>
          <p class="muted">Leave blank and we‚Äôll generate one.</p>
          <label for="customName">Party name</label>
          <input id="customName" type="text" placeholder="e.g., Lexie‚Äôs Birthday Night Out" />
          <div class="badge">
            <span>üí°</span>
            <span>Tip: add the occasion (birthday / pregame / girls night) and a vibe word (cozy / glossy / chaotic).</span>
          </div>
        </div>

        <div class="controls">
          <button class="secondary" id="backBtn" disabled>Back</button>
          <button id="nextBtn">Next</button>
          <button class="ghost" id="resetBtn" type="button">Reset</button>
          <button class="ghost" id="skipToResultsBtn" type="button" title="Jump to results">See results</button>
        </div>
      </section>

      <!-- RIGHT: LIVE PREVIEW + RESULTS -->
      <aside class="card">
        <h2>Live Preview</h2>
        <div class="previewTop">
          <div class="pill">Event: <b id="previewEvent">‚Äî</b></div>
          <div class="pill">Theme: <b id="previewTheme">‚Äî</b></div>
          <div class="pill">Vibe: <b id="previewVibe">‚Äî</b></div>
        </div>

        <p class="big" id="previewName">Your Party Blueprint</p>
        <p class="muted" id="previewOneLiner">Answer the quiz and your plan will update here.</p>

        <div class="swatches" id="previewSwatches" aria-label="Color palette swatches"></div>

        <ul class="miniList" id="previewBullets"></ul>

        <div class="hr"></div>

        <h2>Results</h2>
        <div class="tabs" id="tabs">
          <button class="tab active" data-tab="theme">Theme</button>
          <button class="tab" data-tab="food">Food & Drinks</button>
          <button class="tab" data-tab="timeline">Timeline</button>
          <button class="tab" data-tab="invite">Invite texts</button>
          <button class="tab" data-tab="shop">Shopping</button>
        </div>

        <div class="panel active" id="panel-theme"></div>
        <div class="panel" id="panel-food"></div>
        <div class="panel" id="panel-timeline"></div>
        <div class="panel" id="panel-invite"></div>
        <div class="panel" id="panel-shop"></div>

        <div class="hr"></div>

        <div class="controls">
          <button class="secondary smallBtn" id="downloadBtn" type="button">Download plan (.txt)</button>
          <button class="ghost smallBtn" id="copySummaryBtn" type="button">Copy summary</button>
        </div>
        <p class="hint">Tip: Screenshot the ‚ÄúParty Card‚Äù info at the top for something shareable.</p>
      </aside>
    </div>
  </div>

  <div class="toast" id="toast">Copied!</div>

  <script>
    const VIBES = [
      { id:"fancy",   emoji:"üç∏", title:"Fancy + sleek",  desc:"Cocktail vibes, clean decor, looks expensive." },
      { id:"loud",    emoji:"ü™©", title:"Loud + chaotic", desc:"Pre-game energy, big music, fun + messy." },
      { id:"cozy",    emoji:"üïØÔ∏è", title:"Cozy + intimate",desc:"Small group, warm lighting, low-pressure." },
      { id:"outdoors",emoji:"üåû", title:"Outdoors + airy",desc:"Picnic / backyard / daylight vibes." },
      { id:"artsy",   emoji:"üé®", title:"Artsy + quirky", desc:"Creative theme, DIY touches, unique details." },
      { id:"nerdy",   emoji:"üéÆ", title:"Nerdy + themed", desc:"Strong concept theme, games, inside jokes." }
    ];

    const THEMES = {
      italianSummer: {
        name: "Italian Summer",
        palette: ["#F6E7C1","#D9822B","#6B8E23","#E9E2D0","#B55239"],
        decor: ["lemons", "striped linens", "candles + glassware", "olive branches"],
        outfit: "linen / sundress / gold jewelry",
        drink: "Aperol spritz (mocktail option)",
        activity: "disposable camera challenge"
      },
      oldMoney: {
        name: "Old Money Night",
        palette: ["#0F1A14","#EAE3D2","#B59B4C","#1B2A41","#8C7A5B"],
        decor: ["taper candles", "simple florals", "black/cream table", "gold accents"],
        outfit: "black dress / blazer / minimal jewelry",
        drink: "martini (or sparkling lemonade)",
        activity: "cards / poker / charades"
      },
      studio54: {
        name: "Studio 54 Disco",
        palette: ["#0B0B0F","#D6D6D6","#FF4FD8","#7C4DFF","#00D1FF"],
        decor: ["disco ball", "silver streamers", "LED candles", "glossy signage"],
        outfit: "sparkle / metallic / bold makeup",
        drink: "vodka soda (or cherry soda)",
        activity: "best-dressed + dance pics"
      },
      coquette: {
        name: "Coquette Pink",
        palette: ["#FFF1F6","#F7B2C4","#B35C75","#F5E0E8","#7A2E45"],
        decor: ["bows", "pink napkins", "candles", "cute handwritten labels"],
        outfit: "soft pink / white / ribbons",
        drink: "strawberry spritz (or pink lemonade)",
        activity: "photo corner + compliments jar"
      },
      darkAcademia: {
        name: "Dark Academia",
        palette: ["#1B1A17","#3A2E2A","#D8C3A5","#6E4B3A","#5A5A5A"],
        decor: ["books", "warm lamps", "brown paper tags", "dried florals"],
        outfit: "turtleneck / blazer / boots",
        drink: "red wine (or spiced tea)",
        activity: "mystery prompts / trivia"
      },
      casino: {
        name: "Casino Night",
        palette: ["#0B3D2E","#F2E8CF","#B80C09","#1A1A1A","#C9A227"],
        decor: ["playing cards", "green tablecloth", "gold accents", "chips (fake)"],
        outfit: "black / red / glam",
        drink: "whiskey ginger (or ginger ale)",
        activity: "poker / blackjack (fake money)"
      },
      y2k: {
        name: "Y2K Throwback",
        palette: ["#E6F4FF","#FF77B7","#A78BFA","#C7F9CC","#111111"],
        decor: ["glitter", "butterfly clips", "silver balloons", "funny posters"],
        outfit: "denim / baby tees / metallic",
        drink: "blue raspberry (or soda bar)",
        activity: "karaoke + throwback photos"
      },
      picnic: {
        name: "Golden Hour Picnic",
        palette: ["#FFE7A3","#F4C2C2","#C8E6C9","#F7F1E3","#8A6F52"],
        decor: ["blankets", "flowers", "paper fans", "fruit board"],
        outfit: "sundress / sneakers / sunglasses",
        drink: "lemonade bar",
        activity: "card games + sunset pics"
      },
      murderLite: {
        name: "Murder Mystery Lite",
        palette: ["#111111","#F2F2F2","#7A7A7A","#8B0000","#C2B280"],
        decor: ["name tags", "clue cards", "candles", "simple props"],
        outfit: "any, add one ‚Äòcharacter‚Äô accessory",
        drink: "signature mocktail",
        activity: "mini mystery rounds"
      }
    };

    const NAME_BANK = {
      fancy:   ["Velvet", "Glossy", "Champagne", "Black-Tie-ish", "After Hours"],
      loud:    ["Chaos", "Main Character", "Pre-Game", "Dancefloor", "Rage Lite"],
      cozy:    ["Candlelit", "Soft", "Cozy", "Wine & Whine", "Warm"],
      outdoors:["Golden Hour", "Sunny", "Backyard", "Picnic", "Aperol"],
      artsy:   ["Artsy", "Crafty", "Gallery", "Color Pop", "Quirky"],
      nerdy:   ["Lore", "Quest", "Level Up", "Easter Egg", "Cosplay-ish"]
    };

    const state = {
      step: 0,
      vibe: null,
      budget: 2,
      guests: 12,
      venue: "apartment",
      timeOfDay: "night",
      effort: 2,
      foodStyle: "snacks",
      music: "pop",
      deadline: "week",
      customName: ""
    };

    const totalSteps = 6;

    const steps = Array.from(document.querySelectorAll(".step"));
    const stepNumEl = document.getElementById("stepNum");
    const stepTotalEl = document.getElementById("stepTotal");
    const barEl = document.getElementById("bar");
    const backBtn = document.getElementById("backBtn");
    const nextBtn = document.getElementById("nextBtn");
    const resetBtn = document.getElementById("resetBtn");
    const skipToResultsBtn = document.getElementById("skipToResultsBtn");

    const vibeOptionsEl = document.getElementById("vibeOptions");
    const budgetEl = document.getElementById("budget");
    const guestsEl = document.getElementById("guests");
    const venueEl = document.getElementById("venue");
    const timeEl = document.getElementById("timeOfDay");
    const effortEl = document.getElementById("effort");
    const foodEl = document.getElementById("foodStyle");
    const musicEl = document.getElementById("music");
    const deadlineEl = document.getElementById("deadline");
    const customNameEl = document.getElementById("customName");

    const budgetLabel = document.getElementById("budgetLabel");
    const guestsLabel = document.getElementById("guestsLabel");
    const effortLabel = document.getElementById("effortLabel");

    const previewEvent = document.getElementById("previewEvent");
    const previewTheme = document.getElementById("previewTheme");
    const previewVibe = document.getElementById("previewVibe");
    const previewName = document.getElementById("previewName");
    const previewOneLiner = document.getElementById("previewOneLiner");
    const previewSwatches = document.getElementById("previewSwatches");
    const previewBullets = document.getElementById("previewBullets");

    const panelTheme = document.getElementById("panel-theme");
    const panelFood = document.getElementById("panel-food");
    const panelTimeline = document.getElementById("panel-timeline");
    const panelInvite = document.getElementById("panel-invite");
    const panelShop = document.getElementById("panel-shop");

    const tabs = document.getElementById("tabs");
    const downloadBtn = document.getElementById("downloadBtn");
    const copySummaryBtn = document.getElementById("copySummaryBtn");
    const toast = document.getElementById("toast");

    function showToast(msg="Copied!") {
      toast.textContent = msg;
      toast.classList.add("show");
      setTimeout(() => toast.classList.remove("show"), 900);
    }

    function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }

    function moneyLabel(n){
      if(n===1) return "$ (low)";
      if(n===2) return "$$ (medium)";
      return "$$$ (higher)";
    }
    function effortText(n){
      if(n===1) return "Low lift";
      if(n===2) return "Medium effort";
      return "High effort / DIY";
    }

    function titleCase(s){
      return (s||"").toLowerCase().replace(/\b\w/g, c => c.toUpperCase());
    }

    function vibeObj(id){ return VIBES.find(v => v.id === id); }

    function computeEventType(){
      if(!state.vibe) return "‚Äî";

      const g = state.guests;
      const b = state.budget;
      const v = state.venue;
      const t = state.timeOfDay;
      const e = state.effort;

      if(state.vibe === "cozy"){
        if(g <= 10) return "Cozy Dinner / Wine Night";
        return "Cozy House Hang";
      }
      if(state.vibe === "loud"){
        if(v === "apartment" && g >= 20) return "Apartment Pre-Game / House Party Lite";
        return "Dance-y Party Night";
      }
      if(state.vibe === "fancy"){
        if(b >= 2 && (v === "restaurant" || v === "house")) return "Cocktail Night";
        return "Dress-Up Drinks Night";
      }
      if(state.vibe === "outdoors"){
        if(t !== "night") return "Golden Hour Picnic / Backyard Hang";
        return "Outdoor Night Hang (string lights)";
      }
      if(state.vibe === "artsy"){
        if(e === 3) return "Theme Party (DIY Edition)";
        return "Creative Hang / Craft Night";
      }
      if(state.vibe === "nerdy"){
        return "Theme Party / Game Night";
      }
      return "Hangout";
    }

    function computeThemes(){
      if(!state.vibe) return { primary:null, alts:[] };

      const v = state.vibe;
      const g = state.guests;
      const e = state.effort;
      const venue = state.venue;
      const t = state.timeOfDay;

      let primaryKey = "italianSummer";
      let altKeys = ["oldMoney","studio54"];

      if(v === "cozy"){
        primaryKey = (t === "night") ? "darkAcademia" : "italianSummer";
        altKeys = ["coquette","italianSummer","casino"];
      } else if(v === "loud"){
        primaryKey = (g >= 18) ? "studio54" : "y2k";
        altKeys = ["y2k","casino","studio54"];
      } else if(v === "fancy"){
        primaryKey = "oldMoney";
        altKeys = ["casino","darkAcademia","italianSummer"];
      } else if(v === "outdoors"){
        primaryKey = (venue === "outdoors" || t !== "night") ? "picnic" : "italianSummer";
        altKeys = ["italianSummer","coquette","picnic"];
      } else if(v === "artsy"){
        primaryKey = (e === 3) ? "murderLite" : "coquette";
        altKeys = ["y2k","italianSummer","darkAcademia"];
      } else if(v === "nerdy"){
        primaryKey = "murderLite";
        altKeys = ["casino","y2k","darkAcademia"];
      }

      altKeys = altKeys.filter(k => k !== primaryKey).slice(0,2);
      return { primary: THEMES[primaryKey], alts: altKeys.map(k => THEMES[k]) };
    }

    function generatePartyName(primaryThemeName){
      const vibe = state.vibe;
      const bank = NAME_BANK[vibe] || ["Party"];
      const word = bank[Math.floor(Math.random()*bank.length)];
      const base = primaryThemeName ? primaryThemeName.split(" ")[0] : "Party";
      const timeWord = state.timeOfDay === "day" ? "Day" : (state.timeOfDay === "golden" ? "Hour" : "Night");
      const formatA = `The ${word} ${base} ${timeWord}`;
      const formatB = `${word} ${timeWord}`;
      const formatC = `${base} ${word} Party`;
      const all = [formatA, formatB, formatC];
      return all[Math.floor(Math.random()*all.length)];
    }

    function inviteTexts(partyName, themeName){
      const where = titleCase(state.venue === "apartment" ? "my apartment" :
                   state.venue === "house" ? "my house" :
                   state.venue === "outdoors" ? "outside" :
                   state.venue === "restaurant" ? "a bar/restaurant" : "TBD");
      const when = state.timeOfDay === "day" ? "today" : (state.timeOfDay === "golden" ? "at golden hour" : "tonight");
      const vibe = state.vibe ? vibeObj(state.vibe).title : "a vibe";
      return {
        chill:
`hey!! i‚Äôm doing ${partyName}${themeName ? " ("+themeName+")" : ""} ‚Äî just a ${vibe.toLowerCase()} kind of thing.
${where}. come ${when} ü´∂
bring: good vibes + whatever you want to drink/snack`,
        classy:
`You're invited to ${partyName}${themeName ? " ‚Äî "+themeName : ""}.
Location: ${where}
Time: ${when}
Dress: on-theme (or just look cute)
Reply with a yes so I can plan food + drinks.`,
        chaotic:
`üö® ${partyName.toUpperCase()} üö®
theme: ${themeName || "whatever main character energy you have"}
where: ${where}
when: ${when}
pull up. bring a drink. we‚Äôre making memories ü™©`
      };
    }

    function buildTimeline(){
      const d = state.deadline;
      if(d === "today"){
        return [
          "NOW: text the group + confirm start time",
          "NOW: pick 1 theme + simple palette",
          "2 hours: buy snacks, ice, cups, napkins",
          "1 hour: quick clean, set up lights/music",
          "30 min: chill drinks + set a ‚Äòdrop zone‚Äô",
          "Start: greet people + keep the vibe moving"
        ];
      }
      if(d === "48h"){
        return [
          "Today: lock theme + guest list + time",
          "Today: send invite + ask about dietary needs",
          "Tomorrow: buy decor basics + food/drinks",
          "Day-of: clean, set zones (food/drinks/music), prep playlist",
          "1 hour before: set out ice + cups + snacks"
        ];
      }
      if(d === "week"){
        return [
          "3‚Äì5 days before: pick theme + send invite",
          "3‚Äì5 days before: plan menu + drink list",
          "2‚Äì3 days before: order/buy decor and supplies",
          "1 day before: grocery run + prep what you can",
          "Day-of: clean, set up lighting + playlist, chill drinks",
          "After: quick trash sweep + leftovers plan"
        ];
      }
      return [
        "2 weeks: choose theme + budget + guest list",
        "10 days: invite people + collect RSVPs",
        "1 week: finalize menu + order anything needed",
        "3‚Äì4 days: buy non-perishables + decor",
        "1‚Äì2 days: grocery run + prep",
        "Day-of: set up zones, music, and photo corner"
      ];
    }

    function buildShoppingList(themeObj){
      const base = [
        "Ice + cooler bag",
        "Cups (or glassware) + napkins",
        "Trash bags + paper towels",
        "Snacks (chips + dip + something sweet)",
        "A ‚Äòsignature drink‚Äô ingredient(s)"
      ];

      const decorBase = [
        "Candles or string lights",
        "A simple tablecloth or runner",
        "Tape/scissors + lighter",
        "One ‚Äòstatement‚Äô item (balloons / banner / flowers)"
      ];

      const foodBoost = state.foodStyle === "full" ? ["Main dish ingredients", "Side dish ingredients", "Plates + cutlery"] :
                        state.foodStyle === "potluck" ? ["Sign-up list + serving spoons"] :
                        state.foodStyle === "catered" ? ["Order confirmation + pickup plan"] :
                        ["Charcuterie-ish items (cheese/fruit/crackers)"];

      const themeBoost = themeObj ? [
        `Theme decor: ${themeObj.decor.join(", ")}`,
        `Photo moment: 1‚Äì2 props that match "${themeObj.name}"`
      ] : [];

      const scale = state.guests >= 25 ? ["Extra ice + extra cups", "More trash bags", "2 drink options (alcohol + non)"] : [];

      return [...base, ...decorBase, ...foodBoost, ...themeBoost, ...scale];
    }

    function buildFoodAndDrinks(themeObj){
      const guests = state.guests;
      const style = state.foodStyle;

      const snackIdeas = [
        "chips + guac/salsa",
        "fruit bowl",
        "something crunchy (pretzels/popcorn)",
        "something sweet (cookies/brownies)"
      ];

      const fullMealIdeas = [
        "pasta + salad",
        "taco bar",
        "pizza + salad",
        "sheet pan chicken + veggies"
      ];

      const drinks = [];
      if(themeObj?.drink) drinks.push(themeObj.drink);
      drinks.push("water station (always)");
      if(guests >= 20) drinks.push("2nd drink option (simple + cheap)");

      const food = (style === "full") ? fullMealIdeas : (style === "catered") ? ["order a crowd-pleaser + one vegetarian option"] :
                   (style === "potluck") ? ["assign categories: mains / sides / desserts / drinks"] :
                   snackIdeas;

      return { food, drinks };
    }

    function buildSummaryText(plan){
      return [
        `PARTY BLUEPRINT`,
        `Name: ${plan.partyName}`,
        `Event type: ${plan.eventType}`,
        `Theme: ${plan.theme?.name || "‚Äî"}`,
        `Vibe: ${plan.vibeTitle || "‚Äî"}`,
        ``,
        `Palette: ${plan.theme?.palette?.join(", ") || "‚Äî"}`,
        `Outfit: ${plan.theme?.outfit || "‚Äî"}`,
        `Signature drink: ${plan.theme?.drink || "‚Äî"}`,
        ``,
        `TIMELINE`,
        ...plan.timeline.map(x => `- ${x}`),
        ``,
        `FOOD`,
        ...plan.foodAndDrinks.food.map(x => `- ${x}`),
        ``,
        `DRINKS`,
        ...plan.foodAndDrinks.drinks.map(x => `- ${x}`),
        ``,
        `SHOPPING LIST`,
        ...plan.shopping.map(x => `- ${x}`),
        ``,
        `INVITE TEXTS`,
        `Chill:\n${plan.invites.chill}`,
        ``,
        `Classy:\n${plan.invites.classy}`,
        ``,
        `Chaotic:\n${plan.invites.chaotic}`
      ].join("\n");
    }

    function renderSwatches(palette){
      previewSwatches.innerHTML = "";
      if(!palette || !palette.length) return;
      palette.slice(0,5).forEach(hex => {
        const d = document.createElement("div");
        d.className = "sw";
        d.style.background = hex;
        d.title = hex;
        previewSwatches.appendChild(d);
      });
    }

    function setMiniBullets(items){
      previewBullets.innerHTML = "";
      items.slice(0,4).forEach(t => {
        const li = document.createElement("li");
        li.textContent = t;
        previewBullets.appendChild(li);
      });
    }

    function renderVibeOptions(){
      vibeOptionsEl.innerHTML = "";
      VIBES.forEach(v => {
        const div = document.createElement("div");
        div.className = "opt" + (state.vibe === v.id ? " selected" : "");
        div.tabIndex = 0;
        div.setAttribute("role","button");
        div.setAttribute("aria-pressed", state.vibe === v.id ? "true" : "false");

        div.innerHTML = `
          <div class="emoji">${v.emoji}</div>
          <div>
            <b>${v.title}</b>
            <div class="muted">${v.desc}</div>
          </div>
        `;

        div.addEventListener("click", () => {
          state.vibe = v.id;
          renderVibeOptions();
          updateAll();
          nextBtn.disabled = false;
        });

        div.addEventListener("keydown", (e) => {
          if(e.key === "Enter" || e.key === " "){
            e.preventDefault();
            div.click();
          }
        });

        vibeOptionsEl.appendChild(div);
      });
    }

    function setStep(n){
      state.step = clamp(n, 0, totalSteps-1);
      steps.forEach(s => s.style.display = (Number(s.dataset.step) === state.step) ? "block" : "none");
      stepNumEl.textContent = String(state.step + 1);
      stepTotalEl.textContent = String(totalSteps);
      barEl.style.width = `${Math.round(((state.step+1)/totalSteps)*100)}%`;

      backBtn.disabled = state.step === 0;
      if(state.step === 0){
        nextBtn.disabled = !state.vibe;
      } else {
        nextBtn.disabled = false;
      }
      nextBtn.textContent = (state.step === totalSteps-1) ? "Finish" : "Next";
    }

    function computePlan(){
      const vibeTitle = state.vibe ? vibeObj(state.vibe).title : "‚Äî";
      const eventType = computeEventType();
      const { primary, alts } = computeThemes();
      const theme = primary;
      const partyName = (state.customName && state.customName.trim()) ? state.customName.trim() : generatePartyName(theme?.name);
      const oneLiner = theme ? `${eventType} with a ${theme.name} vibe.` : `${eventType}.`;
      const invites = inviteTexts(partyName, theme?.name);
      const timeline = buildTimeline();
      const shopping = buildShoppingList(theme);
      const foodAndDrinks = buildFoodAndDrinks(theme);

      return { vibeTitle, eventType, theme, alts, partyName, oneLiner, invites, timeline, shopping, foodAndDrinks };
    }

    function applyThemeOverride(plan){
      const key = state._themeOverrideKey;
      if(!key) return plan;
      const theme = THEMES[key];
      return { ...plan, theme };
    }

    function renderResults(plan){
      previewEvent.textContent = plan.eventType;
      previewTheme.textContent = plan.theme?.name || "‚Äî";
      previewVibe.textContent = plan.vibeTitle || "‚Äî";
      previewName.textContent = plan.partyName || "Your Party Blueprint";
      previewOneLiner.textContent = plan.oneLiner;

      renderSwatches(plan.theme?.palette || []);
      setMiniBullets([
        `Guests: ${state.guests} ¬∑ Budget: ${moneyLabel(Number(state.budget))} ¬∑ Effort: ${effortText(Number(state.effort))}`,
        `Outfit: ${plan.theme?.outfit || "‚Äî"}`,
        `Drink: ${plan.theme?.drink || "‚Äî"}`,
        `Activity: ${plan.theme?.activity || "‚Äî"}`
      ]);

      const alts = plan.alts || [];
      panelTheme.innerHTML = `
        <div class="twoCol">
          <div class="card" style="padding:12px;">
            <b>Primary theme</b>
            <div style="margin-top:6px;"><span class="pill">üé≠ ${plan.theme?.name || "‚Äî"}</span></div>
            <div class="hint">Decor: ${plan.theme ? plan.theme.decor.join(", ") : "‚Äî"}</div>
            <div class="hint">Outfit: ${plan.theme?.outfit || "‚Äî"}</div>
            <div class="hint">Signature drink: ${plan.theme?.drink || "‚Äî"}</div>
            <div class="hint">Activity: ${plan.theme?.activity || "‚Äî"}</div>
          </div>
          <div class="card" style="padding:12px;">
            <b>Alt theme ideas</b>
            <div style="margin-top:8px; display:flex; gap:8px; flex-wrap:wrap;">
              ${alts.map(a => `<button class="ghost smallBtn" type="button" data-alt="${a.name}">${a.name}</button>`).join("")}
            </div>
            <div class="hint">Click one to swap your primary theme.</div>
          </div>
        </div>
      `;

      panelTheme.querySelectorAll("[data-alt]").forEach(btn => {
        btn.addEventListener("click", () => {
          const chosen = btn.getAttribute("data-alt");
          const key = Object.keys(THEMES).find(k => THEMES[k].name === chosen);
          if(key){
            state._themeOverrideKey = key;
            updateAll();
            showToast("Theme swapped!");
          }
        });
      });

      panelFood.innerHTML = `
        <div class="card" style="padding:12px;">
          <b>Food plan</b>
          <ul class="miniList">
            ${plan.foodAndDrinks.food.map(x => `<li>${x}</li>`).join("")}
          </ul>
          <b>Drinks</b>
          <ul class="miniList">
            ${plan.foodAndDrinks.drinks.map(x => `<li>${x}</li>`).join("")}
          </ul>
          <div class="hint">Based on: ${titleCase(state.foodStyle)} ¬∑ Guests: ${state.guests}</div>
        </div>
      `;

      panelTimeline.innerHTML = `
        <div class="card" style="padding:12px;">
          <b>Your timeline (${titleCase(state.deadline)})</b>
          <ul class="miniList">
            ${plan.timeline.map(x => `<li>${x}</li>`).join("")}
          </ul>
        </div>
      `;

      panelInvite.innerHTML = `
        <div class="card" style="padding:12px;">
          <b>Invite texts</b>
          <p class="hint">Pick a tone, copy, and send.</p>

          <div style="margin-top:10px;">
            <div class="copyRow">
              <button class="ghost smallBtn" type="button" data-copy="chill">Copy chill</button>
              <button class="ghost smallBtn" type="button" data-copy="classy">Copy classy</button>
              <button class="ghost smallBtn" type="button" data-copy="chaotic">Copy chaotic</button>
            </div>
            <textarea id="inviteBox" aria-label="Invite text">${plan.invites.chill}</textarea>
            <div class="hint">Tip: add your exact date/time after you paste it.</div>
          </div>
        </div>
      `;

      const inviteBox = panelInvite.querySelector("#inviteBox");
      panelInvite.querySelectorAll("[data-copy]").forEach(btn => {
        btn.addEventListener("click", async () => {
          const tone = btn.getAttribute("data-copy");
          inviteBox.value = plan.invites[tone];
          try{
            await navigator.clipboard.writeText(inviteBox.value);
            showToast("Invite copied!");
          }catch{
            inviteBox.select();
            document.execCommand("copy");
            showToast("Invite selected (copy)");
          }
        });
      });

      panelShop.innerHTML = `
        <div class="card" style="padding:12px;">
          <b>Shopping list</b>
          <ul class="miniList">
            ${plan.shopping.map(x => `<li>${x}</li>`).join("")}
          </ul>
          <div class="hint">Want it shorter? Choose Low lift + Snacks + smaller guest count.</div>
        </div>
      `;
    }

    function updateLabels(){
      budgetLabel.textContent = moneyLabel(Number(state.budget));
      guestsLabel.textContent = `${Number(state.guests)} guests`;
      effortLabel.textContent = effortText(Number(state.effort));
    }

    function updateAll(){
      updateLabels();

      let plan = computePlan();
      plan = applyThemeOverride(plan);

      renderResults(plan);

      budgetEl.value = String(state.budget);
      guestsEl.value = String(state.guests);
      venueEl.value = state.venue;
      timeEl.value = state.timeOfDay;
      effortEl.value = String(state.effort);
      foodEl.value = state.foodStyle;
      musicEl.value = state.music;
      deadlineEl.value = state.deadline;
      customNameEl.value = state.customName || "";

      if(state.step === 0){
        nextBtn.disabled = !state.vibe;
      }

      window.__partyPlan = plan;
    }

    budgetEl.addEventListener("input", () => { state.budget = Number(budgetEl.value); updateAll(); });
    guestsEl.addEventListener("input", () => { state.guests = Number(guestsEl.value); updateAll(); });
    venueEl.addEventListener("change", () => { state.venue = venueEl.value; updateAll(); });
    timeEl.addEventListener("change", () => { state.timeOfDay = timeEl.value; updateAll();
